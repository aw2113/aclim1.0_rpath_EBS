# Plots for ACLIM CMIP5 Rpath manuscript

# with colorblind friendly pallete
# .libPaths("C:/Program Files/R/R-3.6.1/library")
library(viridis)
# rcp.line <- viridis(2)
# poly.col <- viridis(2,alpha = 0.4)
# with 10 colors but only using numbers 8 and 1. RCP 8.5 is no. 1 (purple) and RCP 4.5 is no. 8 (green)
rcp.line10 <- viridis(10)
poly.col10 <- viridis(10,alpha = 0.4)

# Plot forcing groups with detritus pools as a 3x3 plot: Portrait, 6.5 x 4.5

par(mfrow=c(3,3), omi=c(0.3,0.3,0.2,0.1))
# Euphausiids f1 biomass ----------------------------------------------------------- #
par(mai=c(0.2,0.3,0.2,0))
# par(mfrow=c(3,2))
plot(ces.yrs,eupB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(eupB.45.f1.up,eupB.85.f1.up)), xlim=c(1991,2099),
     ylab=" ", xlab=" ", xaxt='n')
axis(1, labels=F)
box(col="gray50")
mtext("Euphausiids", side=3, line=0.5, cex=0.8)
# ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# points(1991:2016, SAdat_dens[21:46,"Euphausiids"], pch=16, cex=1)#, col="red")
polygon(c(rcp.yrs,rev(rcp.yrs)), c(eupB.85.f1.up,rev(eupB.85.f1.lo)), col=poly.col10[1],lwd=0.5)
lines(rcp.yrs,mean85.f1.force_BB[,"Euphausiids"], col=rcp.line10[1], lwd=1)
polygon(c(ces.yrs,rev(ces.yrs)), c(eupB.45.f1.up[1:90],rev(eupB.45.f1.lo[1:90])), col=poly.col10[8],lwd=0.5)
lines(ces.yrs,mean85.f1.force_BB[1:90,"Euphausiids"], col=rcp.line10[8], lwd=1)
# polygon(c(a1b.yrs,rev(a1b.yrs)), c(eupB.a1b.f1.up,rev(eupB.a1b.f1.lo)), col=trans.col.eupB.a1b.f1,lwd=0.5)
# lines(a1b.yrs,meanA1B.f1.force_BB[,"Euphausiids"], col="cyan", lwd=2)
lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Euphausiids"], col="gray50", lwd=2)
abline(h=mean(mean85.f1.force_BB[1:27,"Euphausiids"]), lty=1)
abline(h=max(mean85.f1.force_BB[1:27,"Euphausiids"]),lty=2)
abline(h=min(mean85.f1.force_BB[1:27,"Euphausiids"]),lty=2)

# Copepods f1 biomass ----------------------------------------------------------- #
par(mai=c(0.2,0.3,0.2,0))
# par(mfrow=c(3,2))
plot(ces.yrs,copB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(copB.45.f1.up,copB.85.f1.up)), xlim=c(1991,2099),
     ylab=" ", xlab=" ", xaxt='n')
axis(1, labels=F)
box(col="gray50")
mtext("Copepods", side=3, line=0.5, cex=0.8)
# ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# points(1991:2016, SAdat_dens[21:46,"Copepods"], pch=16, cex=1)#, col=rcp.line10[1])
polygon(c(rcp.yrs,rev(rcp.yrs)), c(copB.85.f1.up,rev(copB.85.f1.lo)), col=poly.col10[1],lwd=0.5)
lines(rcp.yrs,mean85.f1.force_BB[,"Copepods"], col=rcp.line10[1], lwd=1)
polygon(c(ces.yrs,rev(ces.yrs)), c(copB.45.f1.up[1:90],rev(copB.45.f1.lo[1:90])), col=poly.col10[8],lwd=0.5)
lines(ces.yrs,mean45.f1.force_BB[1:90,"Copepods"], col=rcp.line10[8], lwd=1)
# polygon(c(a1b.yrs,rev(a1b.yrs)), c(copB.a1b.f1.up,rev(copB.a1b.f1.lo)), col=trans.col.copB.a1b.f1,lwd=0.5)
# lines(a1b.yrs,meanA1B.f1.force_BB[,"Copepods"], col="cyan", lwd=2)
lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Copepods"], col="gray50", lwd=2)
abline(h=mean(mean85.f1.force_BB[1:27,"Copepods"]), lty=1)
abline(h=max(mean85.f1.force_BB[1:27,"Copepods"]),lty=2)
abline(h=min(mean85.f1.force_BB[1:27,"Copepods"]),lty=2)

# Pelagic.microbes f1 biomass ----------------------------------------------------------- #
par(mai=c(0.2,0.3,0.2,0))
# par(mfrow=c(3,2))
plot(ces.yrs,pmcrB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(pmcrB.45.f1.up,pmcrB.85.f1.up)), xlim=c(1991,2099),
     ylab=" ", xlab=" ", xaxt='n')
axis(1, labels=F)
box(col="gray50")
mtext("Pelagic microbes", side=3, line=0.5, cex=0.8)
# ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# points(1991:2016, SAdat_dens[21:46,"Pelagic.microbes"], pch=16, cex=1)#, col=rcp.line10[1])
polygon(c(rcp.yrs,rev(rcp.yrs)), c(pmcrB.85.f1.up,rev(pmcrB.85.f1.lo)), col=poly.col10[1],lwd=0.5)
lines(rcp.yrs,mean85.f1.force_BB[,"Pelagic.microbes"], col=rcp.line10[1], lwd=1)
polygon(c(ces.yrs,rev(ces.yrs)), c(pmcrB.45.f1.up[1:90],rev(pmcrB.45.f1.lo[1:90])), col=poly.col10[8],lwd=0.5)
lines(ces.yrs,mean45.f1.force_BB[1:90,"Pelagic.microbes"], col=rcp.line10[8], lwd=1)
# polygon(c(a1b.yrs,rev(a1b.yrs)), c(pmcrB.a1b.f1.up,rev(pmcrB.a1b.f1.lo)), col=trans.col.pmcrB.a1b.f1,lwd=0.5)
# lines(a1b.yrs,meanA1B.f1.force_BB[,"Pelagic.microbes"], col="cyan", lwd=2)
lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Pelagic.microbes"], col="gray50", lwd=2)
abline(h=mean(mean85.f1.force_BB[1:27,"Pelagic.microbes"]), lty=1)
abline(h=max(mean85.f1.force_BB[1:27,"Pelagic.microbes"]),lty=2)
abline(h=min(mean85.f1.force_BB[1:27,"Pelagic.microbes"]),lty=2)

# Benthic.microbes f1 biomass ----------------------------------------------------------- #
par(mai=c(0.2,0.3,0.2,0))
# par(mfrow=c(3,2))
plot(ces.yrs,bmcrB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(bmcrB.45.f1.up,bmcrB.85.f1.up)), xlim=c(1991,2099),
     ylab=" ", xlab=" ", xaxt='n')
axis(1, labels=F)
box(col="gray50")
mtext("Benthic microbes", side=3, line=0.5, cex=0.8)
# ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# points(1991:2016, SAdat_dens[21:46,"Benthic.microbes"], pch=16, cex=1)#, col=rcp.line10[1])
polygon(c(rcp.yrs,rev(rcp.yrs)), c(bmcrB.85.f1.up,rev(bmcrB.85.f1.lo)), col=poly.col10[1],lwd=0.5)
lines(rcp.yrs,mean85.f1.force_BB[,"Benthic.microbes"], col=rcp.line10[1], lwd=1)
polygon(c(ces.yrs,rev(ces.yrs)), c(bmcrB.45.f1.up[1:90],rev(bmcrB.45.f1.lo[1:90])), col=poly.col10[8],lwd=0.5)
lines(ces.yrs,mean45.f1.force_BB[1:90,"Benthic.microbes"], col=rcp.line10[8], lwd=1)
# polygon(c(a1b.yrs,rev(a1b.yrs)), c(bmcrB.a1b.f1.up,rev(bmcrB.a1b.f1.lo)), col=trans.col.bmcrB.a1b.f1,lwd=0.5)
# lines(a1b.yrs,meanA1B.f1.force_BB[,"Benthic.microbes"], col="cyan", lwd=2)
lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Benthic.microbes"], col="gray50", lwd=2)
abline(h=mean(mean85.f1.force_BB[1:27,"Benthic.microbes"]), lty=1)
abline(h=max(mean85.f1.force_BB[1:27,"Benthic.microbes"]),lty=2)
abline(h=min(mean85.f1.force_BB[1:27,"Benthic.microbes"]),lty=2)

# Tot.phytoplankton f1 biomass ----------------------------------------------------------- #
# par(mai=c(0.2,0.3,0.2,0))
# # par(mfrow=c(3,2))
# plot(ces.yrs,TphtB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(TphtB.45.f1.up,TphtB.85.f1.up)), xlim=c(1991,2099),
#      ylab=" ", xlab=" ", xaxt='n')
# axis(1, labels=F)
# box(col="gray50")
# mtext("Tot.phytoplankton", side=3, line=0.5, cex=0.8)
# # ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# # points(1991:2016, SAdat_dens[21:46,"Tot.phytoplankton"], pch=16, cex=1)#, col=rcp.line10[1])
# polygon(c(rcp.yrs,rev(rcp.yrs)), c(TphtB.85.f1.up,rev(TphtB.85.f1.lo)), col=trans.col.TphtB.85.f1,lwd=0.5)
# lines(rcp.yrs,mean85.f1.force_BB[,"Tot.phytoplankton"], col=rcp.line10[1], lwd=1)
# polygon(c(ces.yrs,rev(ces.yrs)), c(TphtB.45.f1.up[1:90],rev(TphtB.45.f1.lo[1:90])), col=trans.col.TphtB.45.f1,lwd=0.5)
# lines(ces.yrs,mean45.f1.force_BB[1:90,"Tot.phytoplankton"], col=rcp.line10[8]", lwd=1)
# # polygon(c(a1b.yrs,rev(a1b.yrs)), c(TphtB.a1b.f1.up,rev(TphtB.a1b.f1.lo)), col=trans.col.TphtB.a1b.f1,lwd=0.5)
# # lines(a1b.yrs,meanA1B.f1.force_BB[,"Tot.phytoplankton"], col="cyan", lwd=2)
# lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Tot.phytoplankton"], col="gray50", lwd=2)
# abline(h=mean(mean85.f1.force_BB[1:27,"Tot.phytoplankton"]), lty=1)
# abline(h=max(mean85.f1.force_BB[1:27,"Tot.phytoplankton"]),lty=2)
# abline(h=min(mean85.f1.force_BB[1:27,"Tot.phytoplankton"]),lty=2)

# Lg.phytoplankton f1 biomass ----------------------------------------------------------- #
par(mai=c(0.2,0.3,0.2,0))
# par(mfrow=c(3,2))
plot(ces.yrs,lphtB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(lphtB.45.f1.up,lphtB.85.f1.up)), xlim=c(1991,2099),
     ylab=" ", xlab=" ", xaxt='n')
axis(1, labels=F)
box(col="gray50")
mtext("Large phytoplankton", side=3, line=0.5, cex=0.8)
# ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# points(1991:2016, SAdat_dens[21:46,"Lg.phytoplankton"], pch=16, cex=1)#, col=rcp.line10[1])
polygon(c(rcp.yrs,rev(rcp.yrs)), c(lphtB.85.f1.up,rev(lphtB.85.f1.lo)), col=poly.col10[1],lwd=0.5)
lines(rcp.yrs,mean85.f1.force_BB[,"Lg.phytoplankton"], col=rcp.line10[1], lwd=1)
polygon(c(ces.yrs,rev(ces.yrs)), c(lphtB.45.f1.up[1:90],rev(lphtB.45.f1.lo[1:90])), col=poly.col10[8],lwd=0.5)
lines(ces.yrs,mean45.f1.force_BB[1:90,"Lg.phytoplankton"], col=rcp.line10[8], lwd=1)
# polygon(c(a1b.yrs,rev(a1b.yrs)), c(lphtB.a1b.f1.up,rev(lphtB.a1b.f1.lo)), col=trans.col.lphtB.a1b.f1,lwd=0.5)
# lines(a1b.yrs,meanA1B.f1.force_BB[,"Lg.phytoplankton"], col="cyan", lwd=2)
lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Lg.phytoplankton"], col="gray50", lwd=2)
abline(h=mean(mean85.f1.force_BB[1:27,"Lg.phytoplankton"]), lty=1)
abline(h=max(mean85.f1.force_BB[1:27,"Lg.phytoplankton"]),lty=2)
abline(h=min(mean85.f1.force_BB[1:27,"Lg.phytoplankton"]),lty=2)

# Sm.phytoplankton f1 biomass ----------------------------------------------------------- #
par(mai=c(0.2,0.3,0.2,0))
# par(mfrow=c(3,2))
plot(ces.yrs,sphtB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(sphtB.45.f1.up,sphtB.85.f1.up)), xlim=c(1991,2099),
     ylab=" ", xlab=" ")
box(col="gray50")
mtext("Small phytoplankton", side=3, line=0.5, cex=0.8)
# ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# points(1991:2016, SAdat_dens[21:46,"Sm.phytoplankton"], pch=16, cex=1)#, col=rcp.line10[1])
polygon(c(rcp.yrs,rev(rcp.yrs)), c(sphtB.85.f1.up,rev(sphtB.85.f1.lo)), col=poly.col10[1],lwd=0.5)
lines(rcp.yrs,mean85.f1.force_BB[,"Sm.phytoplankton"], col=rcp.line10[1], lwd=1)
polygon(c(ces.yrs,rev(ces.yrs)), c(sphtB.45.f1.up[1:90],rev(sphtB.45.f1.lo[1:90])), col=poly.col10[8],lwd=0.5)
lines(ces.yrs,mean45.f1.force_BB[1:90,"Sm.phytoplankton"], col=rcp.line10[8], lwd=1)
# polygon(c(a1b.yrs,rev(a1b.yrs)), c(sphtB.a1b.f1.up,rev(sphtB.a1b.f1.lo)), col=trans.col.sphtB.a1b.f1,lwd=0.5)
# lines(a1b.yrs,meanA1B.f1.force_BB[,"Sm.phytoplankton"], col="cyan", lwd=2)
lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Sm.phytoplankton"], col="gray50", lwd=2)
abline(h=mean(mean85.f1.force_BB[1:27,"Sm.phytoplankton"]), lty=1)
abline(h=max(mean85.f1.force_BB[1:27,"Sm.phytoplankton"]),lty=2)
abline(h=min(mean85.f1.force_BB[1:27,"Sm.phytoplankton"]),lty=2)

# ============================================================================ #
# Detritus Plots
# Pelagic.Detritus f1 biomass ----------------------------------------------------------- #
par(mai=c(0.2,0.3,0.2,0))
# par(mfrow=c(3,2))
plot(ces.yrs,pdetB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(pdetB.45.f1.up,pdetB.85.f1.up)), xlim=c(1991,2099),
     ylab=" ", xlab=" ")
box(col="gray50")
mtext("Pelagic detritus", side=3, line=0.5, cex=0.8)
# ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# points(1991:2016, SAdat_dens[21:46,"Pelagic.Detritus"], pch=16, cex=1)#, col=rcp.line10[1])
polygon(c(rcp.yrs,rev(rcp.yrs)), c(pdetB.85.f1.up,rev(pdetB.85.f1.lo)), col=poly.col10[1],lwd=0.5)
lines(rcp.yrs,mean85.f1.force_BB[,"Pelagic.Detritus"], col=rcp.line10[1], lwd=1)
polygon(c(ces.yrs,rev(ces.yrs)), c(pdetB.45.f1.up[1:90],rev(pdetB.45.f1.lo[1:90])), col=poly.col10[8],lwd=0.5)
lines(ces.yrs,mean45.f1.force_BB[1:90,"Pelagic.Detritus"], col=rcp.line10[8], lwd=1)
# polygon(c(a1b.yrs,rev(a1b.yrs)), c(pdetB.a1b.f1.up,rev(pdetB.a1b.f1.lo)), col=trans.col.pdetB.a1b.f1,lwd=0.5)
# lines(a1b.yrs,meanA1B.f1.force_BB[,"Pelagic.Detritus"], col="cyan", lwd=2)
lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Pelagic.Detritus"], col="gray50", lwd=2)
abline(h=mean(mean85.f1.force_BB[1:27,"Pelagic.Detritus"]), lty=1)
abline(h=max(mean85.f1.force_BB[1:27,"Pelagic.Detritus"]),lty=2)
abline(h=min(mean85.f1.force_BB[1:27,"Pelagic.Detritus"]),lty=2)

# Benthic.Detritus f1 biomass ----------------------------------------------------------- #
par(mai=c(0.2,0.3,0.2,0))
# par(mfrow=c(3,2))
plot(ces.yrs,bdetB.45.f1.up[1:90], col=FALSE, ylim=c(0,max(bdetB.45.f1.up,bdetB.85.f1.up)), xlim=c(1991,2099),
     ylab=" ", xlab=" ")
box(col="gray50")
mtext("Benthic detritus", side=3, line=0.5, cex=0.8)
# ylab with exponent: ylab=expression('Biomass (t km'^"-2"*')')
# points(1991:2016, SAdat_dens[21:46,"Benthic.Detritus"], pch=16, cex=1)#, col=rcp.line10[1])
polygon(c(rcp.yrs,rev(rcp.yrs)), c(bdetB.85.f1.up,rev(bdetB.85.f1.lo)), col=poly.col10[1],lwd=0.5)
lines(rcp.yrs,mean85.f1.force_BB[,"Benthic.Detritus"], col=rcp.line10[1], lwd=1)
polygon(c(ces.yrs,rev(ces.yrs)), c(bdetB.45.f1.up[1:90],rev(bdetB.45.f1.lo[1:90])), col=poly.col10[8],lwd=0.5)
lines(ces.yrs,mean45.f1.force_BB[1:90,"Benthic.Detritus"], col=rcp.line10[8], lwd=1)
# polygon(c(a1b.yrs,rev(a1b.yrs)), c(bdetB.a1b.f1.up,rev(bdetB.a1b.f1.lo)), col=trans.col.bdetB.a1b.f1,lwd=0.5)
# lines(a1b.yrs,meanA1B.f1.force_BB[,"Benthic.Detritus"], col="cyan", lwd=2)
lines(rcp.yrs[1:27],mean85.f1.force_BB[1:27,"Benthic.Detritus"], col="gray50", lwd=2)
abline(h=mean(mean85.f1.force_BB[1:27,"Benthic.Detritus"]), lty=1)
abline(h=max(mean85.f1.force_BB[1:27,"Benthic.Detritus"]),lty=2)
abline(h=min(mean85.f1.force_BB[1:27,"Benthic.Detritus"]),lty=2)

# Dummy plot in the bottom corner to put the legend in
plot(ces.yrs,bdetB.45.f1.up[1:90],type='n', xaxt='n', yaxt='n', bty='n',axes = FALSE)
legend("bottomleft", legend = c("RCP 4.5", "RCP 8.5"),
       fill = c(rcp.line10[8], rcp.line10[1]),
       bty="n", cex=1.5, y.intersp = 1.5, border=NA)

mtext("Year", side=1, outer=T, at=0.53, line=1, cex=1)
mtext(expression('Biomass (t km'^"-2"*')'), side=2, outer=T, at=0.5, cex=1, line=0.4)
